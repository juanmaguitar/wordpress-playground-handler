"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=Symbol("SleepFinished");function p(e){return new Promise(t=>{setTimeout(()=>t(a),e)})}class d extends Error{constructor(){super("Acquiring lock timed out")}}class E{constructor({concurrency:t,timeout:i}){this._running=0,this.concurrency=t,this.timeout=i,this.queue=[]}get remaining(){return this.concurrency-this.running}get running(){return this._running}async acquire(){for(;;)if(this._running>=this.concurrency){const t=new Promise(i=>{this.queue.push(i)});this.timeout!==void 0?await Promise.race([t,p(this.timeout)]).then(i=>{if(i===a)throw new d}):await t}else{this._running++;let t=!1;return()=>{t||(t=!0,this._running--,this.queue.length>0&&this.queue.shift()())}}}async run(t){const i=await this.acquire();try{return await t()}finally{i()}}}class b extends Error{constructor(t,i){super(t),this.userFriendlyMessage=i??t}}function w(...e){function t(u){return u.substring(u.length-1)==="/"}let i=e.join("/");const s=i[0]==="/",n=t(i);return i=l(i),!i&&!s&&(i="."),i&&n&&!t(i)&&(i+="/"),i}function S(e){if(e==="/")return"/";e=l(e);const t=e.lastIndexOf("/");return t===-1?"":t===0?"/":e.substr(0,t)}function P(e){if(e==="/")return"/";e=l(e);const t=e.lastIndexOf("/");return t===-1?e:e.substr(t+1)}function l(e){const t=e[0]==="/";return e=O(e.split("/").filter(i=>!!i),!t).join("/"),(t?"/":"")+e.replace(/\/$/,"")}function O(e,t){let i=0;for(let s=e.length-1;s>=0;s--){const n=e[s];n==="."?e.splice(s,1):n===".."?(e.splice(s,1),i++):i&&(e.splice(s,1),i--)}if(t)for(;i;i--)e.unshift("..");return e}function x(e,t){return e==="/"?!0:(e=l(e),t=l(t),t.startsWith(e+"/")||t===e)}function D(e){let s=0,n="";const u=[];let r="";for(let o=0;o<e.length;o++){const c=e[o];c==="\\"?((e[o+1]==='"'||e[o+1]==="'")&&o++,r+=e[o]):s===0?c==='"'||c==="'"?(s=1,n=c):c.match(/\s/)?(r.trim().length&&u.push(r.trim()),r=c):u.length&&!r?r=u.pop()+c:r+=c:s===1&&(c===n?(s=0,n=""):r+=c)}return r&&u.push(r.trim()),u}function T(e){return function(t,i=[],s={}){const n=new U,u=new _(n);return setTimeout(async()=>{let r=[];if(i.length)r=[t,...i];else if(typeof t=="string")r=D(t);else if(Array.isArray(t))r=t;else throw new Error("Invalid command ",t);try{await e(r,u,s)}catch(o){n.emit("error",o),typeof o=="object"&&o!==null&&"message"in o&&typeof o.message=="string"&&u.stderr(o.message),u.exit(1)}n.emit("spawn",!0)}),n}}class f{constructor(){this.listeners={}}emit(t,i){this.listeners[t]&&this.listeners[t].forEach(function(s){s(i)})}on(t,i){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(i)}}class _ extends f{constructor(t){super(),this.exited=!1,this.stdinData=[],this.childProcess=t,t.on("stdin",i=>{this.stdinData?this.stdinData.push(i.slice()):this.emit("stdin",i)})}stdout(t){typeof t=="string"&&(t=new TextEncoder().encode(t)),this.childProcess.stdout.emit("data",t)}stdoutEnd(){this.childProcess.stdout.emit("end",{})}stderr(t){typeof t=="string"&&(t=new TextEncoder().encode(t)),this.childProcess.stderr.emit("data",t)}stderrEnd(){this.childProcess.stderr.emit("end",{})}notifySpawn(){this.childProcess.emit("spawn",!0)}exit(t){this.exited||(this.exited=!0,this.childProcess.emit("exit",t))}flushStdin(){if(this.stdinData)for(let t=0;t<this.stdinData.length;t++)this.emit("stdin",this.stdinData[t]);this.stdinData=null}}let A=9743;class U extends f{constructor(t=A++){super(),this.stdout=new f,this.stderr=new f;const i=this;this.pid=t,this.stdin={write:s=>{i.emit("stdin",s)}}}}function g(e=36,t="!@#$%^&*()_+=-[]/.,<>?"){const i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"+t;let s="";for(let n=e;n>0;--n)s+=i[Math.floor(Math.random()*i.length)];return s}function M(){return g(36,"-_")}function m(e){return`json_decode(base64_decode('${N(JSON.stringify(e))}'), true)`}function q(e){const t={};for(const i in e)t[i]=m(e[i]);return t}function N(e){return j(new TextEncoder().encode(e))}function j(e){const t=String.fromCodePoint(...e);return btoa(t)}function k(e,...t){let i="",s=0;for(let n=0;n<e.length;n++)if(e[n]==="%"&&n+1<e.length){n++;const u=e[n];switch(u){case"s":{const r=t[s++];let o;if(typeof r=="object")try{o=JSON.stringify(r,(c,h)=>typeof h=="bigint"?`0x${h.toString(16)}`:h,2)}catch{}else o=String(r);i+=o;break}case"d":{const r=t[s++];typeof r=="bigint"?i+=r.toString():i+=Math.floor(Number(r));break}case"f":{const r=t[s++];i+=Number(r);break}case"x":{const r=t[s++];typeof r=="bigint"?i+=r.toString(16):i+=Math.floor(Number(r)).toString(16);break}case"%":{i+="%";break}default:i+="%"+u}}else i+=e[n];return i}function y(e){let t=0;e.forEach(n=>t+=n.length);const i=new Uint8Array(t);let s=0;return e.forEach(n=>{i.set(n,s),s+=n.length}),i}function I(e){return y(e.map(t=>new Uint8Array(t))).buffer}exports.AcquireTimeoutError=d;exports.PhpWasmError=b;exports.Semaphore=E;exports.basename=P;exports.concatArrayBuffers=I;exports.concatUint8Arrays=y;exports.createSpawnHandler=T;exports.dirname=S;exports.isParentOf=x;exports.joinPaths=w;exports.normalizePath=l;exports.phpVar=m;exports.phpVars=q;exports.randomFilename=M;exports.randomString=g;exports.sprintf=k;
//# sourceMappingURL=index.cjs.map
