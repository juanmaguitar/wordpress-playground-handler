"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("@php-wasm/node-polyfills");const p="playground-log",l=(e,...r)=>{E.dispatchEvent(new CustomEvent(p,{detail:{log:e,args:r}}))},h=(e,...r)=>{switch(typeof e.message=="string"?Reflect.set(e,"message",n(e.message)):e.message.message&&typeof e.message.message=="string"&&Reflect.set(e.message,"message",n(e.message.message)),e.severity){case"Debug":console.debug(e.message,...r);break;case"Info":console.info(e.message,...r);break;case"Warn":console.warn(e.message,...r);break;case"Error":console.error(e.message,...r);break;case"Fatal":console.error(e.message,...r);break;default:console.log(e.message,...r)}},v=e=>e instanceof Error?[e.message,e.stack].join(`
`):JSON.stringify(e,null,2),i=[],f=e=>{i.push(e)},a=e=>{if(e.raw===!0)f(e.message);else{const r=w(typeof e.message=="object"?v(e.message):e.message,e.severity??"Info",e.prefix??"JavaScript");f(r)}},T=()=>{i.length=0};let c=0;const d="/wordpress/wp-content/debug.log",M=async e=>await e.fileExists(d)?await e.readFileAsText(d):"",P=(e,r)=>{r.addEventListener("request.end",async()=>{const s=await M(r);if(s.length>c){const t=s.substring(c);e.logMessage({message:t,raw:!0}),c=s.length}}),r.addEventListener("request.error",s=>{s=s,s.error&&(e.logMessage({message:`${s.error.message} ${s.error.stack}`,severity:"Fatal",prefix:s.source==="request"?"PHP":"WASM Crash"}),e.dispatchEvent(new CustomEvent(e.fatalErrorEvent,{detail:{logs:e.getLogs(),source:s.source}})))})};class y extends EventTarget{constructor(r=[]){super(),this.fatalErrorEvent="playground-fatal-error",this.handlers=r}getLogs(){return this.handlers.includes(a)?[...i]:(this.error(`Logs aren't stored because the logToMemory handler isn't registered.
				If you're using a custom logger instance, make sure to register logToMemory handler.
			`),[])}logMessage(r,...s){for(const t of this.handlers)t(r,...s)}log(r,...s){this.logMessage({message:r,severity:void 0,prefix:"JavaScript",raw:!1},...s)}debug(r,...s){this.logMessage({message:r,severity:"Debug",prefix:"JavaScript",raw:!1},...s)}info(r,...s){this.logMessage({message:r,severity:"Info",prefix:"JavaScript",raw:!1},...s)}warn(r,...s){this.logMessage({message:r,severity:"Warn",prefix:"JavaScript",raw:!1},...s)}error(r,...s){this.logMessage({message:r,severity:"Error",prefix:"JavaScript",raw:!1},...s)}}const O=()=>{try{if(process.env.NODE_ENV==="test")return[a,l]}catch{}return[a,h,l]},E=new y(O()),n=e=>e.replace(/\t/g,""),w=(e,r,s)=>{const t=new Date,o=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",timeZone:"UTC"}).format(t).replace(/ /g,"-"),L=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"UTC",timeZoneName:"short"}).format(t),b=o+" "+L;return e=n(e),`[${b}] ${s} ${r}: ${e}`},S=(e,r)=>{e.addEventListener(e.fatalErrorEvent,r)},k=(e,r)=>{e.logMessage({message:`${r.message} in ${r.filename} on line ${r.lineno}:${r.colno}`,severity:"Error"})},m=(e,r)=>{if(!(r!=null&&r.reason))return;const s=(r==null?void 0:r.reason.stack)??r.reason;e.logMessage({message:s,severity:"Error"})};let g=0;const $=e=>{navigator.serviceWorker.addEventListener("message",r=>{var s,t,o;((s=r.data)==null?void 0:s.numberOfOpenPlaygroundTabs)!==void 0&&g!==((t=r.data)==null?void 0:t.numberOfOpenPlaygroundTabs)&&(g=(o=r.data)==null?void 0:o.numberOfOpenPlaygroundTabs,e.debug(`Number of open Playground tabs is: ${g}`))})};let u=!1;const x=e=>{u||($(e),!(typeof window>"u")&&(window.addEventListener("error",r=>k(e,r)),window.addEventListener("unhandledrejection",r=>m(e,r)),window.addEventListener("rejectionhandled",r=>m(e,r)),u=!0))},C=e=>{e.addEventListener("activate",()=>{e.clients.matchAll().then(r=>{const s={numberOfOpenPlaygroundTabs:r.filter(t=>t.frameType==="top-level").length};for(const t of r)t.postMessage(s)})})};exports.Logger=y;exports.addCrashListener=S;exports.clearMemoryLogs=T;exports.collectPhpLogs=P;exports.collectWindowErrors=x;exports.errorLogPath=d;exports.formatLogEntry=w;exports.logEvent=l;exports.logEventType=p;exports.logToConsole=h;exports.logToMemory=a;exports.logger=E;exports.logs=i;exports.prepareLogMessage=n;exports.reportServiceWorkerMetrics=C;
//# sourceMappingURL=index.cjs.map
