"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("@php-wasm/universal"),w=require("@php-wasm/node"),k=require("@php-wasm/progress"),W=require("@wp-playground/wordpress"),S=require("@php-wasm/util"),c=require("worker_threads"),E=require("tls");function h(o,e){for(const t of e)o.mkdir(t.vfsPath),o.mount(t.vfsPath,w.createNodeFsMountHandler(t.hostPath))}function D(o,e,...t){console.log(performance.now().toFixed(6).padStart(15,"0"),o.toString().padStart(16,"0"),S.sprintf(e,...t))}class f extends a.PHPWorker{constructor(e){super(void 0,e),this.booted=!1}async boot({absoluteUrl:e,mountsBeforeWpInstall:t,mountsAfterWpInstall:m,phpVersion:y="8.0",wordPressZip:l,sqliteIntegrationPluginZip:d,firstProcessId:n,processIdSpaceLength:b,dataSqlPath:g,followSymlinks:_,trace:v}){if(this.booted)throw new Error("Playground already booted");this.booted=!0;let r=n;const q=n+b-1,u=a.consumeAPI(c.parentPort);await u.isConnected();try{const s={WP_DEBUG:!0,WP_DEBUG_LOG:!0,WP_DEBUG_DISPLAY:!1},p=await W.bootWordPress({siteUrl:e,createPhpRuntime:async()=>{const i=r;return r<q?r++:r=n,await w.loadNodeRuntime(y,{emscriptenOptions:{fileLockManager:u,processId:i,trace:v?D:void 0},followSymlinks:_})},wordPressZip:l!==void 0?new File([l],"wordpress.zip"):void 0,sqliteIntegrationPluginZip:d!==void 0?new File([d],"sqlite-integration-plugin.zip"):void 0,sapiName:"cli",createFiles:{"/internal/shared/ca-bundle.crt":E.rootCertificates.join(`
`)},constants:s,phpIniEntries:{"openssl.cafile":"/internal/shared/ca-bundle.crt",allow_url_fopen:"1",disable_functions:""},hooks:{async beforeWordPressFiles(i){h(i,t)}},cookieStore:!1,dataSqlPath:g});this.__internal_setRequestHandler(p);const P=await p.getPrimaryPhp();await this.setPrimaryPHP(P),h(P,m),F()}catch(s){throw I(s),s}}async dispose(){await this[Symbol.asyncDispose]()}}const[F,I]=a.exposeAPI(new f(new k.EmscriptenDownloadMonitor),void 0,c.parentPort);c.parentPort.postMessage("worker-script-initialized");exports.PlaygroundCliWorker=f;
//# sourceMappingURL=worker-thread.cjs.map
