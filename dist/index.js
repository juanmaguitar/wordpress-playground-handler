var H=Object.defineProperty;var n=(t,e)=>H(t,"name",{value:e,configurable:!0});import{createNodeFsMountHandler as p,loadNodeRuntime as g}from"@php-wasm/node";import{bootWordPress as b,resolveWordPressRelease as w}from"@wp-playground/wordpress";import{rootCertificates as R}from"tls";import{compileBlueprint as q,runBlueprintSteps as y}from"@wp-playground/blueprints";async function s(t,e){let r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch ${t}: ${r.statusText}`);let a=await r.blob();return new File([a],e)}n(s,"fetchFileAsFileObject");async function P(t,e){let r=await w("6.8"),a=await s(r.releaseUrl,`${r.version}.zip`),f=await s("https://github.com/WordPress/sqlite-database-integration/archive/refs/heads/develop.zip","sqlite.zip"),u=await b({siteUrl:"http://localhost:8080",createPhpRuntime:n(async()=>await g("8.3"),"createPhpRuntime"),wordPressZip:a,sqliteIntegrationPluginZip:f,sapiName:"cli",createFiles:{"/internal/shared/ca-bundle.crt":R.join(`
`)},phpIniEntries:{"openssl.cafile":"/internal/shared/ca-bundle.crt",allow_url_fopen:"1",disable_functions:""},cookieStore:!1}),o=await u.getPrimaryPhp();e?.databasePath&&(o.mkdir("/wordpress/wp-content/database/"),o.mount("/wordpress/wp-content/database/",p(e.databasePath))),e?.muPluginsPath&&(o.mkdir("/wordpress/wp-content/mu-plugins/"),o.mount("/wordpress/wp-content/mu-plugins/",p(e.muPluginsPath)));let h=await q(t);return await y(h,o),u}n(P,"createPlaygroundRequestHandler");var i=Symbol.for("HANDLER_PROMISE");function d(t,e){let r=global;return r[i]||(r[i]=B(t,e)),r[i]}n(d,"getSingletonHandlerPromise");async function B(t,e){console.log("Creating singleton Playground handler...");let r=await P(t,e);return console.log("Singleton Playground handler created successfully"),r}n(B,"createHandler");import{readFileSync as c}from"fs";import{resolve as m}from"path";import{PHPRequestHandler as G,PHPRequest as J,PHPResponse as U}from"@php-wasm/universal";import{Blueprint as T}from"@wp-playground/blueprints";var l=null;async function L(t={}){if(!l){let e;t.blueprint?e=t.blueprint:t.blueprintPath?e=JSON.parse(c(m(t.blueprintPath),"utf8")):e=JSON.parse(c(m("./wordpress/blueprint.json"),"utf8")),l=d(e,t.mountPaths)}return l}n(L,"getPlaygroundHandler");export{T as Blueprint,J as PHPRequest,G as PHPRequestHandler,U as PHPResponse,L as getPlaygroundHandler};
